{% comment %}
  AI Search Booster - LLM Schema Snippets
  
  This snippet generates structured data for LLM visibility when enabled.
  Rollback: Removing the app or setting asb_enable_schema to false disables all output.
  
  Schema types generated:
  - Product JSON-LD (name, description, brand, price, variants, etc.)
  - FAQPage JSON-LD (minimum 3 Q&A pairs)
  - BreadcrumbList JSON-LD (navigation path)
  - Organization/Brand graph
{% endcomment %}

{% assign enable_schema = product.metafields.asb.enable_schema %}
{% assign optimized_content = product.metafields.asb.optimized_content %}
{% assign faq_data = product.metafields.asb.faq_data %}
{% assign brand_data = shop.metafields.asb.brand_data %}

{% if enable_schema %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "Product",
      "name": {{ product.title | json }},
      "description": {% if optimized_content %}{{ optimized_content | json }}{% else %}{{ product.description | strip_html | json }}{% endif %},
      "brand": {
        "@type": "Brand",
        "name": {{ product.vendor | json }}
        {% if brand_data %}
          {% assign brand_parsed = brand_data | parse_json %}
          {% if brand_parsed.wikidata_id %},
          "sameAs": "https://www.wikidata.org/wiki/{{ brand_parsed.wikidata_id }}"
          {% endif %}
        {% endif %}
      },
      "sku": {{ product.selected_or_first_available_variant.sku | json }},
      {% if product.selected_or_first_available_variant.barcode %}
      "gtin": {{ product.selected_or_first_available_variant.barcode | json }},
      {% endif %}
      "image": [
        {% for image in product.images limit: 5 %}
          "{{ image | image_url: width: 800 }}"{% unless forloop.last %},{% endunless %}
        {% endfor %}
      ],
      "offers": {
        "@type": "Offer",
        "priceCurrency": {{ cart.currency.iso_code | json }},
        "price": {{ product.selected_or_first_available_variant.price | divided_by: 100.0 | json }},
        "priceValidUntil": "{{ 'now' | date: '%s' | plus: 2592000 | date: '%Y-%m-%d' }}",
        "availability": "{% if product.selected_or_first_available_variant.available %}https://schema.org/InStock{% else %}https://schema.org/OutOfStock{% endif %}",
        "seller": {
          "@type": "Organization",
          "name": {{ shop.name | json }},
          "url": "{{ shop.url }}"
        }
      },
      "url": "{{ shop.url }}{{ product.url }}",
      {% if product.variants.size > 1 %}
      "hasVariant": [
        {% for variant in product.variants limit: 10 %}
        {
          "@type": "ProductModel",
          "name": {{ variant.title | json }},
          "sku": {{ variant.sku | json }},
          "offers": {
            "@type": "Offer",
            "priceCurrency": {{ cart.currency.iso_code | json }},
            "price": {{ variant.price | divided_by: 100.0 | json }},
            "availability": "{% if variant.available %}https://schema.org/InStock{% else %}https://schema.org/OutOfStock{% endif %}"
          }
        }{% unless forloop.last %},{% endunless %}
        {% endfor %}
      ],
      {% endif %}
      "category": {% if collection %}{{ collection.title | json }}{% else %}"{{ product.product_type }}"{% endif %}
    }
    {% if faq_data %}
    ,{
      "@type": "FAQPage",
      "mainEntity": [
        {% assign faq_parsed = faq_data | parse_json %}
        {% for faq in faq_parsed.questions limit: 10 %}
        {
          "@type": "Question",
          "name": {{ faq.question | json }},
          "acceptedAnswer": {
            "@type": "Answer",
            "text": {{ faq.answer | json }}
          }
        }{% unless forloop.last %},{% endunless %}
        {% endfor %}
      ]
    }
    {% endif %}
    {% if collection %}
    ,{
      "@type": "BreadcrumbList",
      "itemListElement": [
        {
          "@type": "ListItem",
          "position": 1,
          "name": "Home",
          "item": "{{ shop.url }}"
        },
        {
          "@type": "ListItem", 
          "position": 2,
          "name": {{ collection.title | json }},
          "item": "{{ shop.url }}{{ collection.url }}"
        },
        {
          "@type": "ListItem",
          "position": 3,
          "name": {{ product.title | json }},
          "item": "{{ shop.url }}{{ product.url }}"
        }
      ]
    }
    {% endif %}
    ,{
      "@type": "Organization",
      "name": {{ shop.name | json }},
      "url": "{{ shop.url }}",
      "logo": {
        "@type": "ImageObject",
        "url": "{{ 'logo.png' | asset_url }}"
      }
      {% if brand_data %}
        {% assign brand_parsed = brand_data | parse_json %}
        {% if brand_parsed.wikidata_id %},
        "sameAs": "https://www.wikidata.org/wiki/{{ brand_parsed.wikidata_id }}"
        {% endif %}
      {% endif %}
    }
  ]
}
</script>

{% comment %}
  LLM Feed discovery link
  Helps crawlers find the RSS feed for LLM training data
{% endcomment %}
<link rel="alternate" type="application/rss+xml" title="{{ shop.name }} - LLM Feed" href="https://ai-search-booster-backend.onrender.com/llm-feed.xml?shop={{ shop.myshopify_domain }}">

{% endif %}